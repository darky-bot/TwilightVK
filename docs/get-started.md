## Начало

### Импорт библиотеки

Как и любой другой фреймворк для начала работы вам необходимо его импортировать
```python
import twilight_vk
```

### Инициализация бота

Инициализация происходит путем создания экземпляра класса TwilightVK с передачей следующих параметров:
+ `BOT_NAME`
  >Имя бота - необходим для идентификации в API Swagger при использовании TwilightAPI
  >По умолчанию: `"TwilightVK"`
+ `ACCESS_TOKEN`*
  >Токен вашего сообщества/приложения
+ `GROUP_ID`*
  >ID вашей группы в случае с сообществами
+ `API_VERSION`
+ >Версия VK API
  >По умолчанию: `"5.199"`
+ `API_MODE`
  >Режим работы фреймворка
  >По умолчанию: `"BOTSLONGPOLL"`
  >+ `"BOTSLONGPOLL"` - Для работы с событиями сообщества
  >+ `"USERLONGPOLL"`(В разработке!) - Для работы с событиями пользователя
  >+ `"CALLBACK"`(В разработке!) - Для отслеживания активности пользователей в сообществе
```python
bot = twilight_vk.TwilightVK(
    BOT_NAME="TestBot",
    ACCESS_TOKEN="YourTokenHere",
    GROUP_ID=123
)
```

### Запуск бота
В текущем виде бот уже готов работать и принимать события. Запускается бот простой командой `start()`
```python
bot.start()
```

### Создание простого echo бота
Добавим в нашего только что созданного бота простую функцию которая при новом сообщении ответит таким же текстом.

Для этого необходимо воспользоваться декоратором on_event, который является частью нашего экземпляра класса TwilightVK()
```python
@bot.on_event.message_new()
```
> + `bot` - наш экземпляр класса TwilightVK()
> + `on_event` - декоратор, позволяющий привязать свою функцию к какому-либо обработчику
> + `message_new` - это нужный нам обработчик, который срабатывает при каждом новом сообщении в чате

Теперь допишем под декоратором нашу функцию, которая будет возвращать в ответ текст сообщения
```python
@bot.on_event.message_new()
async def echo(event: dict):
    return event["object"]["message"]["text"]
```
> + Функции, которые будут привязаны к обработчикам должны быть асинхронными
> + `event: dict` всегда должен приниматься первым в параметрах функции, поскольку через него передаётся произошедшее событие. Наличие дополнительных параметров зависит от использования правил в обработчиках (см. "Фильтрация событий", "Правила")

Готово! Теперь у нас есть бот который на любое сообщение будет отвечать таким же текстом

### Остановка бота
Остановить уже запущенного бота можно несколькими способами:
+ Через KeyboardInterrupt(Ctrl+C) (Hard Shutdown)
+ Через код (Soft Shutdown)
+ Через TwilightAPI (Hard/Soft Shutdown)
> Hard Shutdown подразумевает немедленную остановку бота без ожидания завершения работы всех обработчиков

##### KeyboardInterrupt
При данном виде завершения работы фреймворк выдаст пару предупреждений, что прослушивание событий и их обработка была завершена досрочно и немедленно завершит свою работу
```
twilight-vk   | WARNING   | KeyboardInterrupt recieved, shutting down...
twilight-vk   | WARNING   | Forced stop. For soft stop - use TwilightVK.should_stop() method
botslongpoll  | WARNING   | Listening was forcibly canceled (it is not recommend to do this)
```

##### Soft Shutdown
Фреймворк позволяет завершить работу мягко, через использование специального метода `should_stop()`

Для того чтобы завершить работу необходимо просто прописать строчку `bot.should_stop()` там, где необходимо будет завершить его работу
> Пример:
> ```python
> @bot.on_event.message_new(TextRule=["stop"])
> async def stop_command(event: dict):
>     bot.should_stop()
>     return "Бот скоро завершит свою работу"
> ```

Данная функция не завершает работу, а лишь даёт понять фреймворку что пора закругляться.
Как только все обработчики и события на момент вызова метода будут обработаны - фреймворк завершит свою работу.

##### TwilightAPI
Модуль `TwilightAPI` и каждый привязанный к нему бот, содержат методы `/stop` через которые можно отправить сигналы завершения работы

Достаточно отправить `HTTP-GET` запрос по адресу метода и фреймворк завершит свою работу
Пример запроса который завершает работу бота с названием `SimpleBot` (указывается в `BOT_NAME` в классе `TwilightVK`):
```
curl http://localhost:8000/api/v1/SimpleBot/stop/
```

> + `/stop` принимает один единственный параметр `force`, который должен быть равен `True` или `False` в зависимости от того какой тип завершения работы нам нужен.
> + `/stop` в роутере API от TwilightVK() завершит работу конкретно этого бота
> + `/stop` в роутере API от TwilightAPI() завершит работу всех привязанных к нему ботов 

См. также
+ [Использование обработчиков событий]()

[Содержание](/docs/content.md)